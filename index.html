
<!doctype html>
<html lang="hu">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Era 0 – Map Overview (Zoom + Pan)</title>
<style>
  :root{
    --ui-bg: rgba(22,22,28,.92);
    --ui-fg: #fff;
  }
  html,body{height:100%;margin:0;background:#0f1420;color:#fff;font:14px/1.4 system-ui;}
  #hud{
    position:fixed;left:12px;top:12px;z-index:10;
    background:var(--ui-bg);color:var(--ui-fg);
    padding:10px 12px;border-radius:12px;max-width:min(520px, 92vw);
  }
  #hud b{font-weight:700}
  #hud .hint{opacity:.75;margin-top:6px;font-size:12px;line-height:1.35}
  #cam-ui{
    position:fixed;left:12px;bottom:12px;z-index:10;
    display:flex;gap:8px;
  }
  .btn{
    padding:8px 10px;border:1px solid #454950;border-radius:10px;
    background:#0f1117;color:#fff;cursor:pointer;
  }

  /* Viewport: itt mozog és zoomol a map */
  #viewport{
    position:fixed; inset:0; display:grid; place-items:center;
  }
  #frame{
    width:min(94vw, 1200px);
    height:min(82vh, 860px);
    border-radius:22px;
    overflow:hidden;
    box-shadow:0 20px 60px rgba(0,0,0,.35);
    background:linear-gradient(180deg,#6fb1ff 0%, #d8f0ff 40%, #cfe6ff 70%);
    position:relative;
  }
  #wrap{
    position:absolute; left:0; top:0;
    transform-origin:0 0;
    will-change:transform;
  }

  /* Mini-map */
  #minimap{
    position:fixed; right:12px; bottom:12px; z-index:10;
    width:220px; height:140px;
    border-radius:14px; overflow:hidden;
    background:rgba(0,0,0,.35);
    border:1px solid rgba(255,255,255,.15);
    backdrop-filter: blur(6px);
  }
  #miniSvg{width:100%;height:100%;display:block;opacity:.95}
  #viewRect{fill:none;stroke:#4cc;stroke-width:2;opacity:.9}

  /* SVG “site” marker */
  .site{cursor:pointer}
  .site .pin{fill:#111;stroke:#fff;stroke-opacity:.5;stroke-width:2}
  .site .core{fill:#ffd166}
  .site.locked .core{fill:#888}
  .site text{font: 12px system-ui; fill:#fff; paint-order: stroke; stroke:#000; stroke-width:3px; stroke-linejoin:round;}
  .site:hover .pin{stroke-opacity:.9}
  .selected .pin{stroke:#4cc;stroke-opacity:1}

  /* Kis “faluközpont” ikon */
  .hut{opacity:.9}
</style>
</head>
<body>

<div id="hud">
  <b>Era 0 – Kezdeti térkép (áttekintő)</b>
  <div class="hint">
    • Zoom: egérgörgő / pinch<br>
    • Mozgás: húzd a térképet (drag)<br>
    • Fit: ⤢ gomb<br>
    • Kattints egy helyszínre: kijelölés
  </div>
</div>

<div id="cam-ui">
  <button class="btn" id="zoom-out">−</button>
  <button class="btn" id="zoom-in">+</button>
  <button class="btn" id="zoom-fit">⤢</button>
</div>

<div id="minimap">
  <svg id="miniSvg" viewBox="0 0 2000 1300" aria-label="Minimap">
    <!-- (Ugyanaz a háttér leegyszerűsítve) -->
    <rect width="2000" height="1300" fill="#7fbf7f"/>
    <path d="M -200 240 C 260 70, 650 320, 980 220 S 1900 240, 2200 380"
          fill="none" stroke="#5fb6ff" stroke-width="160" stroke-linecap="round" opacity=".5"/>
    <path d="M 0 700 C 500 630, 780 820, 1200 760 S 1800 840, 2100 760"
          fill="none" stroke="#c2a26a" stroke-width="70" stroke-linecap="round" opacity=".65"/>
    <rect id="viewRect" x="0" y="0" width="100" height="100"></rect>
  </svg>
</div>

<div id="viewport">
  <div id="frame">
    <!-- A teljes “világ” nagyobb, mint a viewport -->
    <div id="wrap">
      <svg id="world" width="2000" height="1300" viewBox="0 0 2000 1300" aria-label="Era 0 map">
        <defs>
          <!-- Finom zaj a talajra -->
          <filter id="noise">
            <feTurbulence type="fractalNoise" baseFrequency=".8" numOctaves="2" stitchTiles="stitch" />
            <feColorMatrix type="matrix" values="
              1 0 0 0 0
              0 1 0 0 0
              0 0 1 0 0
              0 0 0 .08 0" />
          </filter>

          <linearGradient id="grass" x1="0" x2="1">
            <stop offset="0%" stop-color="#8fd18f"/>
            <stop offset="100%" stop-color="#6bbd6b"/>
          </linearGradient>

          <linearGradient id="dirt" x1="0" x2="1">
            <stop offset="0%" stop-color="#d6b57a"/>
            <stop offset="100%" stop-color="#b88d55"/>
          </linearGradient>
        </defs>

        <!-- Talaj -->
        <rect width="2000" height="1300" fill="url(#grass)"/>
        <rect width="2000" height="1300" filter="url(#noise)" opacity=".55"/>

        <!-- Folyó -->
        <path d="M -200 240 C 260 70, 650 320, 980 220 S 1900 240, 2200 380"
              fill="none" stroke="#5fb6ff" stroke-width="170" stroke-linecap="round" opacity=".55"/>
        <path d="M -200 240 C 260 70, 650 320, 980 220 S 1900 240, 2200 380"
              fill="none" stroke="#bfeaff" stroke-width="120" stroke-linecap="round" opacity=".35"/>

        <!-- Földutak (Era 0 jelleg) -->
        <path d="M 0 700 C 500 630, 780 820, 1200 760 S 1800 840, 2100 760"
              fill="none" stroke="url(#dirt)" stroke-width="90" stroke-linecap="round" opacity=".85"/>
        <path d="M 620 1240 C 720 1020, 820 910, 980 820 C 1160 720, 1340 700, 1580 520"
              fill="none" stroke="url(#dirt)" stroke-width="70" stroke-linecap="round" opacity=".8"/>
        <path d="M 840 120 C 900 220, 950 310, 1000 420 C 1080 580, 1160 660, 1280 720"
              fill="none" stroke="url(#dirt)" stroke-width="70" stroke-linecap="round" opacity=".75"/>

        <!-- Mezők (parcellák) -->
        <g opacity=".35">
          <rect x="260" y="820" width="260" height="140" rx="18" fill="#f3e6b2"/>
          <rect x="560" y="840" width="300" height="160" rx="18" fill="#f7d9a1"/>
          <rect x="880" y="900" width="280" height="150" rx="18" fill="#f3e6b2"/>
          <rect x="1220" y="880" width="330" height="170" rx="18" fill="#f7d9a1"/>
        </g>

        <!-- Erdő foltok -->
        <g opacity=".40">
          <ellipse cx="260" cy="420" rx="220" ry="160" fill="#2f7d2f"/>
          <ellipse cx="1680" cy="980" rx="240" ry="170" fill="#2f7d2f"/>
          <ellipse cx="1500" cy="240" rx="220" ry="150" fill="#2f7d2f"/>
        </g>

        <!-- Faluközpont (házikók) -->
        <g class="hut" transform="translate(940 700)">
          <circle cx="0" cy="0" r="72" fill="#000" opacity=".08"/>
          <g transform="translate(-60 -40)">
            <polygon points="0,40 40,10 80,40 80,90 0,90" fill="#5b3a1f"/>
            <polygon points="0,40 40,0 80,40" fill="#8a4f2c"/>
          </g>
          <g transform="translate(20 -30)">
            <polygon points="0,40 35,15 70,40 70,80 0,80" fill="#5b3a1f"/>
            <polygon points="0,40 35,10 70,40" fill="#8a4f2c"/>
          </g>
        </g>

        <!-- 8–10 unlock spot (most “rom/telephely” jelölők) -->
        <g id="sites">
          <!-- id, x,y, locked? -->
          <g class="site locked" data-id="S1" transform="translate(780 740)">
            <circle class="pin" r="22"></circle><circle class="core" r="10"></circle>
            <text x="30" y="5">Telephely 1</text>
          </g>
          <g class="site locked" data-id="S2" transform="translate(1120 760)">
            <circle class="pin" r="22"></circle><circle class="core" r="10"></circle>
            <text x="30" y="5">Telephely 2</text>
          </g>
          <g class="site locked" data-id="S3" transform="translate(1460 560)">
            <circle class="pin" r="22"></circle><circle class="core" r="10"></circle>
            <text x="30" y="5">Telephely 3</text>
          </g>
          <g class="site locked" data-id="S4" transform="translate(520 1020)">
            <circle class="pin" r="22"></circle><circle class="core" r="10"></circle>
            <text x="30" y="5">Telephely 4</text>
          </g>
          <g class="site locked" data-id="S5" transform="translate(980 1040)">
            <circle class="pin" r="22"></circle><circle class="core" r="10"></circle>
            <text x="30" y="5">Telephely 5</text>
          </g>
          <g class="site locked" data-id="S6" transform="translate(1320 980)">
            <circle class="pin" r="22"></circle><circle class="core" r="10"></circle>
            <text x="30" y="5">Telephely 6</text>
          </g>
          <g class="site locked" data-id="S7" transform="translate(420 560)">
            <circle class="pin" r="22"></circle><circle class="core" r="10"></circle>
            <text x="30" y="5">Telephely 7</text>
          </g>
          <g class="site locked" data-id="S8" transform="translate(1240 360)">
            <circle class="pin" r="22"></circle><circle class="core" r="10"></circle>
            <text x="30" y="5">Telephely 8</text>
          </g>
          <g class="site locked" data-id="S9" transform="translate(1680 260)">
            <circle class="pin" r="22"></circle><circle class="core" r="10"></circle>
            <text x="30" y="5">Telephely 9</text>
          </g>
          <g class="site locked" data-id="S10" transform="translate(220 260)">
            <circle class="pin" r="22"></circle><circle class="core" r="10"></circle>
            <text x="30" y="5">Telephely 10</text>
          </g>
        </g>
      </svg>
    </div>
  </div>
</div>

<script>
/* ===== Kamera (zoom + pan) ===== */
const frame = document.getElementById('frame');
const wrap  = document.getElementById('wrap');
const world = document.getElementById('world');
const sites = document.getElementById('sites');
const viewRect = document.getElementById('viewRect');

const cam = {
  x: 0, y: 0, s: 1,
  min: 0.55, max: 2.5,
  dragging: false,
  lastX: 0, lastY: 0,
  worldW: 2000, worldH: 1300
};

function clamp(v,a,b){ return Math.max(a, Math.min(b,v)); }

function applyCam(){
  // clamp pan
  const vw = frame.clientWidth, vh = frame.clientHeight;
  const w  = cam.worldW * cam.s,  h = cam.worldH * cam.s;

  if (w <= vw) cam.x = (vw - w)/2;
  else cam.x = clamp(cam.x, vw - w, 0);

  if (h <= vh) cam.y = (vh - h)/2;
  else cam.y = clamp(cam.y, vh - h, 0);

  wrap.style.transform = `translate(${cam.x}px, ${cam.y}px) scale(${cam.s})`;
  updateMini();
}

function fit(){
  const vw = frame.clientWidth, vh = frame.clientHeight;
  const s = Math.min(vw / cam.worldW, vh / cam.worldH) * 0.98;
  cam.s = clamp(s, cam.min, cam.max);
  cam.x = (vw - cam.worldW*cam.s)/2;
  cam.y = (vh - cam.worldH*cam.s)/2;
  applyCam();
}

function zoomAt(factor, cx, cy){
  const old = cam.s;
  const next = clamp(old*factor, cam.min, cam.max);
  if (next === old) return;

  // világ koordináta a kurzor alatt
  const wx = (cx - cam.x) / old;
  const wy = (cy - cam.y) / old;

  cam.s = next;
  cam.x = cx - wx*next;
  cam.y = cy - wy*next;
  applyCam();
}

/* Drag csak akkor induljon, ha nem site-on nyomtál */
frame.addEventListener('mousedown', (e)=>{
  const isSite = e.target.closest && e.target.closest('.site');
  if (isSite) return;
  cam.dragging = true;
  cam.lastX = e.clientX; cam.lastY = e.clientY;
});
window.addEventListener('mousemove', (e)=>{
  if (!cam.dragging) return;
  cam.x += (e.clientX - cam.lastX);
  cam.y += (e.clientY - cam.lastY);
  cam.lastX = e.clientX; cam.lastY = e.clientY;
  applyCam();
});
window.addEventListener('mouseup', ()=> cam.dragging=false);

frame.addEventListener('wheel', (e)=>{
  e.preventDefault();
  const rect = frame.getBoundingClientRect();
  const cx = e.clientX - rect.left;
  const cy = e.clientY - rect.top;
  zoomAt(e.deltaY < 0 ? 1.12 : 0.89, cx, cy);
},{passive:false});

/* Touch pinch/drag */
let mode=null;
let pinch={dist:0, s:1, midX:0, midY:0};

function dist(a,b){ return Math.hypot(a.clientX-b.clientX, a.clientY-b.clientY); }
function mid(a,b){ return {x:(a.clientX+b.clientX)/2, y:(a.clientY+b.clientY)/2}; }

frame.addEventListener('touchstart', (e)=>{
  if (e.touches.length===1){
    mode='drag';
    cam.dragging=true;
    cam.lastX=e.touches[0].clientX; cam.lastY=e.touches[0].clientY;
  } else if (e.touches.length===2){
    mode='pinch';
    cam.dragging=false;
    const a=e.touches[0], b=e.touches[1];
    pinch.dist = dist(a,b);
    pinch.s = cam.s;
    const m=mid(a,b);
    const rect=frame.getBoundingClientRect();
    pinch.midX = m.x - rect.left;
    pinch.midY = m.y - rect.top;
  }
},{passive:false});

frame.addEventListener('touchmove', (e)=>{
  e.preventDefault();
  if (mode==='drag' && e.touches.length===1 && cam.dragging){
    cam.x += e.touches[0].clientX - cam.lastX;
    cam.y += e.touches[0].clientY - cam.lastY;
    cam.lastX = e.touches[0].clientX;
    cam.lastY = e.touches[0].clientY;
    applyCam();
  } else if (mode==='pinch' && e.touches.length===2){
    const a=e.touches[0], b=e.touches[1];
    const d=dist(a,b);
    const factor=d/pinch.dist;
    const target=clamp(pinch.s*factor, cam.min, cam.max);
    const cx=pinch.midX, cy=pinch.midY;
    const old=cam.s;
    const wx=(cx-cam.x)/old, wy=(cy-cam.y)/old;
    cam.s=target;
    cam.x=cx-wx*target;
    cam.y=cy-wy*target;
    applyCam();
  }
},{passive:false});

frame.addEventListener('touchend', ()=>{ mode=null; cam.dragging=false; });

/* Site kiválasztás */
let selected=null;
sites.querySelectorAll('.site').forEach(node=>{
  node.addEventListener('click', ()=>{
    sites.querySelectorAll('.site').forEach(n=>n.classList.remove('selected'));
    node.classList.add('selected');
    selected = node.dataset.id;
    // később itt nyitjuk majd meg a “build/reno” panelt
    console.log('Selected site:', selected);
  });
});

/* Mini-map viewport rect frissítés */
function updateMini(){
  const vw = frame.clientWidth, vh = frame.clientHeight;
  const x = (-cam.x)/cam.s;
  const y = (-cam.y)/cam.s;
  const w = vw/cam.s;
  const h = vh/cam.s;
  viewRect.setAttribute('x', x);
  viewRect.setAttribute('y', y);
  viewRect.setAttribute('width', w);
  viewRect.setAttribute('height', h);
}

/* UI gombok */
document.getElementById('zoom-in').onclick  = ()=> zoomAt(1.15, frame.clientWidth/2, frame.clientHeight/2);
document.getElementById('zoom-out').onclick = ()=> zoomAt(0.87, frame.clientWidth/2, frame.clientHeight/2);
document.getElementById('zoom-fit').onclick = ()=> fit();

window.addEventListener('resize', ()=> fit());
fit();
</script>
</body>
</html>
``
