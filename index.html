
<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Infinity Tycoon ‚Äì V√°ros</title>
  <style>
    :root{
      --city-w: 12; --city-h: 8; --tile: 72px;
      --ui-bg: rgba(18,18,18,.92);
      --ui-fg: #fff; --ui-acc: #38f; --ui-ok: #1a5; --ui-warn:#b53;
    }
    html,body{height:100%; margin:0; background:#0e1726; color:#fff; font:14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans", Arial, sans-serif;}
    #city{position:fixed; inset:0; display:grid; place-items:center; z-index:1;
      background: linear-gradient(180deg,#6fb1ff,#e4f1ff 40%,#c9e7ff 70%);
    }
    #city-grid{
      display:grid; grid-template-columns:repeat(var(--city-w), var(--tile));
      grid-template-rows:repeat(var(--city-h), var(--tile)); gap:6px; padding:14px;
      border-radius:18px; background:rgba(255,255,255,.45);
      box-shadow:0 20px 60px rgba(0,0,0,.25); backdrop-filter: blur(8px);
    }
    .tile{ width:var(--tile); height:var(--tile); position:relative; border-radius:14px; overflow:hidden; box-shadow: inset 0 0 0 1px rgba(0,0,0,.08); user-select:none; cursor:pointer; }
    .road{ background: linear-gradient(90deg, transparent 47%, #eee 47%, #eee 53%, transparent 53%), #2d2d2d; }
    .lot{ background: radial-gradient(20% 20% at 20% 30%, rgba(0,0,0,.08), transparent 60%), repeating-linear-gradient(45deg, #a7dba7 0 8px, #9ad19a 8px 16px); }
    .road.cross::after{ content:""; position:absolute; inset:10% 10%; background: repeating-linear-gradient(90deg, #eee 0 8px, transparent 8px 16px), repeating-linear-gradient(0deg, #eee 0 8px, transparent 8px 16px); mix-blend-mode:screen; opacity:.2; }
    .tile.sel{ outline:3px solid #4cc; }

    /* HUD */
    #hud{ position:fixed; left:12px; top:12px; z-index:3; background:var(--ui-bg); color:var(--ui-fg); padding:8px 10px; border-radius:12px; display:flex; gap:16px; align-items:center; }
    #hud b{font-weight:700}
    #hud .sep{opacity:.35}

    /* Quick menu */
    #menu{ position:fixed; right:12px; top:12px; z-index:3; background:var(--ui-bg); color:var(--ui-fg); padding:8px; border-radius:12px; display:flex; gap:6px; }
    .btn{ padding:8px 10px; border:1px solid #444; border-radius:10px; background:#111; color:#fff; cursor:pointer; }
    .btn:disabled{ opacity:.5; cursor:not-allowed; }
    .btn.ok{ background:#124; border-color:#246; }

    /* Action bar */
    #actions{ position:fixed; left:50%; bottom:16px; transform:translateX(-50%); display:flex; gap:8px; z-index:3; }
    #actions .btn.build{ background:#1a4; border-color:#083; }
    #actions .btn.upg{ background:#284; border-color:#173; }
    #actions .btn.info{ background:#333; border-color:#444; }

    /* Toast */
    #toast{ position:fixed; bottom:16px; left:50%; transform:translateX(-50%); background:#222; color:#fff; padding:8px 12px; border-radius:8px; font-size:14px; z-index:4; opacity:0; transition:opacity .2s; }

    /* Factory visual */
    .factory{ position:absolute; inset:10%; border-radius:10px; padding:4px 6px; display:grid; align-content:end; gap:3px; pointer-events:none; background: linear-gradient(#333,#111); box-shadow: inset 0 -6px 0 rgba(255,255,255,.05), 0 6px 16px rgba(0,0,0,.35); }
    .factory .roof{ height:10px; border-radius:4px 4px 2px 2px; background:linear-gradient(#b33,#822); box-shadow:0 2px 0 rgba(0,0,0,.25); }
    .factory .body{ background: linear-gradient(90deg, rgba(255,255,255,.06) 0 10%, transparent 10% 20%, rgba(255,255,255,.06) 20% 30%, transparent 30% 40%, rgba(255,255,255,.06) 40% 50%, transparent 50% 60%, rgba(255,255,255,.06) 60% 70%, transparent 70% 80%, rgba(255,255,255,.06) 80% 90%), linear-gradient(#2a2a2a,#151515); border-radius:6px; height:65%; position:relative; }
    .factory .chimneys{ position:absolute; left:6px; top:-12px; display:flex; gap:6px; }
    .chimney{ width:8px; height:18px; background:#555; border-radius:2px; position:relative; }
    .chimney::after{ content:""; position:absolute; left:50%; transform:translateX(-50%); top:-12px; width:10px; height:12px; border-radius:50%; background: radial-gradient(closest-side, rgba(255,255,255,.6), rgba(255,255,255,0)); animation: smoke 1.8s infinite ease-in; }
    @keyframes smoke{ 0%{ transform: translate(-50%,0) scale(.7); opacity:.9; } 100%{ transform: translate(-50%,-18px) scale(1.2); opacity:0; } }
    .badge{ position:absolute; right:6px; top:6px; background:#1a5; color:#fff; padding:2px 6px; border-radius:999px; font:12px/1.2 system-ui; box-shadow:0 1px 0 rgba(0,0,0,.4); }

    @media (max-width: 900px){ :root{ --tile: 56px; } #hud{left:8px; top:8px} #menu{right:8px; top:8px} }
  </style>
</head>
<body>
  <!-- HUD -->
  <div id="hud">
    üí∞ P√©nz: <b id="hud-money">0</b>
    <span class="sep">|</span>
    ‚öôÔ∏è Termel√©s: <b id="hud-ips">0 /s</b>
    <span class="sep">|</span>
    üèÖ Prestige: <b id="hud-prestige">0</b>
  </div>

  <!-- Men√º: ment√©s, bet√∂lt√©s, export, import, sz√ºnet, reset -->
  <div id="menu">
    <button class="btn" id="btn-save" title="Ment√©s">üíæ</button>
    <button class="btn" id="btn-load" title="Bet√∂lt√©s">‚§æ</button>
    <button class="btn" id="btn-export" title="Export">‚§¥Ô∏é</button>
    <button class="btn" id="btn-import" title="Import">‚§µÔ∏é</button>
    <button class="btn" id="btn-pause" title="Sz√ºnet/Folytat√°s">‚èØ</button>
    <button class="btn" id="btn-reset" title="Reset">üóë</button>
  </div>

  <!-- V√°ros -->
  <div id="city">
    <div id="city-grid" aria-label="V√°rosh√°l√≥"></div>
  </div>

  <!-- Akci√≥k -->
  <div id="actions" hidden>
    <button class="btn build" id="act-build">Gy√°r √©p√≠t√©se</button>
    <button class="btn upg"   id="act-upg">Fejleszt√©s</button>
    <button class="btn info"  id="act-info">Inf√≥</button>
  </div>

  <div id="toast"></div>

  <script>
  // ======= Be√°ll√≠t√°sok =======
  const CITY_W = 12, CITY_H = 8;     // r√°cs m√©ret
  const ROAD_ROWS = new Set([1, 4, 7]);
  const ROAD_COLS = new Set([2, 6, 9]);

  const BUILD_COST  = 500;            // √∫j gy√°r √°ra
  const UPG_BASE    = 400;            // fejleszt√©s alap
  const UPG_MUL     = 1.35;           // fejleszt√©s szorz√≥
  const BASE_IPS_L1 = 1.5;            // 1. szint termel√©s
  const LV_IPS_G    = 1.6;            // szintenk√©nti szorz√≥

  const SAVE_KEY    = 'infinity-tycoon-city-save';
  const SAVE_MS     = 10000;          // autosave 10s

  // ======= √Ållapot =======
  const state = {
    money: 0,
    prestige: 0,
    city: { w: CITY_W, h: CITY_H, factories: [] }, // {x,y,level}
    lastTick: Date.now(),
    paused: false
  };

  // ======= Helper =======
  const fmt = n => !isFinite(n) ? '‚àû' : (n < 1e6 ? Math.floor(n).toLocaleString('hu-HU') : (function(){ const u=['','K','M','B','T','Qa','Qi','Sx','Sp','Oc','No','De']; let i=0; while(n>=1000 && i<u.length-1){ n/=1000; i++; } return n.toFixed(2)+' '+u[i]; })());
  const isRoad = (x,y)=> ROAD_ROWS.has(y) || ROAD_COLS.has(x);
  const hasFactory = (x,y)=> state.city.factories.some(f=>f.x===x && f.y===y);
  const getFactory = (x,y)=> state.city.factories.find(f=>f.x===x && f.y===y);
  function ipsForLevel(lv){ return BASE_IPS_L1 * Math.pow(LV_IPS_G, lv-1) * (1 + state.prestige * 0.5); }
  function upgradeCost(lv){ return Math.floor(UPG_BASE * Math.pow(UPG_MUL, lv-1)); }
  function totalIPS(){ return state.city.factories.reduce((s,f)=> s + ipsForLevel(f.level), 0); }

  // ======= HUD =======
  const elMoney = document.getElementById('hud-money');
  const elIPS   = document.getElementById('hud-ips');
  const elPrest = document.getElementById('hud-prestige');
  function updateHUD(){ elMoney.textContent = fmt(state.money); elIPS.textContent = fmt(totalIPS())+' /s'; elPrest.textContent = state.prestige; }

  // ======= Toast =======
  const elToast = document.getElementById('toast');
  function toast(msg){ elToast.textContent = msg; elToast.style.opacity='1'; clearTimeout(toast._t); toast._t=setTimeout(()=>{ elToast.style.opacity='0'; }, 1200); }

  // ======= Grid =======
  const grid = document.getElementById('city-grid');
  grid.style.setProperty('--city-w', CITY_W);
  grid.style.setProperty('--city-h', CITY_H);
  let selected = null;

  function buildGrid(){
    grid.innerHTML = '';
    for(let y=0;y<CITY_H;y++){
      for(let x=0;x<CITY_W;x++){
        const t=document.createElement('div');
        t.className='tile '+(isRoad(x,y)?'road':'lot');
        if(isRoad(x,y) && ROAD_ROWS.has(y) && ROAD_COLS.has(x)) t.classList.add('cross');
        t.dataset.x=x; t.dataset.y=y;
        t.addEventListener('click', onTileClick);
        grid.appendChild(t);
      }
    }
    renderFactories();
  }

  function factoryHTML(level){
    const chimneys = Math.min(1+Math.floor((level-1)/2), 4);
    const colorShift = Math.min(level-1, 6);
    const roofGrad = `linear-gradient(#${['b33','b53','b73','b93','bb3','bd3','bf3'][colorShift]},#822)`;
    const bodyShade = Math.min(40 + level*4, 80);
    return `
      <div class="factory">
        <div class="roof" style="background:${roofGrad}"></div>
        <div class="body" style="background:
          linear-gradient(90deg, rgba(255,255,255,.06) 0 10%, transparent 10% 20%, rgba(255,255,255,.06) 20% 30%, transparent 30% 40%, rgba(255,255,255,.06) 40% 50%, transparent 50% 60%, rgba(255,255,255,.06) 60% 70%, transparent 70% 80%, rgba(255,255,255,.06) 80% 90%),
          linear-gradient(#2a2a2a,#1${bodyShade}1${bodyShade})">
          <div class="chimneys">${'<div class="chimney"></div>'.repeat(chimneys)}</div>
        </div>
        <div class="badge">Lv ${level}</div>
      </div>`;
  }

  function renderFactories(){
    for(const t of grid.children){ t.querySelectorAll('.factory').forEach(e=>e.remove()); }
    for(const f of state.city.factories){
      const idx = f.y * CITY_W + f.x;
      const tile = grid.children[idx];
      if(tile) tile.insertAdjacentHTML('beforeend', factoryHTML(f.level));
    }
    updateHUD();
  }

  // ======= Akci√≥k =======
  const actBar   = document.getElementById('actions');
  const btnBuild = document.getElementById('act-build');
  const btnUpg   = document.getElementById('act-upg');
  const btnInfo  = document.getElementById('act-info');

  function onTileClick(e){
    for(const t of grid.children) t.classList.remove('sel');
    const t = e.currentTarget; t.classList.add('sel');
    selected = { x:+t.dataset.x, y:+t.dataset.y };
    const road = isRoad(selected.x, selected.y);
    const f = getFactory(selected.x, selected.y);
    actBar.hidden = false;
    btnBuild.disabled = road || !!f || state.money < BUILD_COST;
    btnUpg.disabled   = !f || state.money < upgradeCost(f.level);
    btnInfo.disabled  = !f;
    btnBuild.textContent = `Gy√°r √©p√≠t√©se (${fmt(BUILD_COST)})`;
    if (f) btnUpg.textContent = `Fejleszt√©s ‚Üí Lv ${f.level+1} (${fmt(upgradeCost(f.level))})`;
  }

  btnBuild.onclick = ()=>{
    if(!selected) return; if(isRoad(selected.x, selected.y)) return; if(hasFactory(selected.x, selected.y)) return; if(state.money < BUILD_COST) return;
    state.money -= BUILD_COST;
    state.city.factories.push({x:selected.x, y:selected.y, level:1});
    renderFactories(); updateHUD(); saveNow(false); toast('Gy√°r √©p√≠tve');
  };
  btnUpg.onclick = ()=>{
    if(!selected) return; const f=getFactory(selected.x, selected.y); if(!f) return; const cost=upgradeCost(f.level); if(state.money < cost) return;
    state.money -= cost; f.level++; renderFactories(); updateHUD(); saveNow(false); toast('Fejlesztve');
  };
  btnInfo.onclick = ()=>{
    if(!selected) return; const f=getFactory(selected.x, selected.y); if(!f) return;
    alert(`Gy√°r inf√≥:\nKoordin√°ta: (${f.x+1}, ${f.y+1})\nSzint: ${f.level}\nTermel√©s: ${ipsForLevel(f.level).toFixed(2)} /s\nK√∂vetkez≈ë √°r: ${fmt(upgradeCost(f.level))}`);
  };

  // ======= Ment√©s / Bet√∂lt√©s / Offline =======
  function gameGetState(){
    return { version:1, money:state.money, prestige:state.prestige, city:state.city, lastTick:Date.now() };
  }
  function gameSetState(s){
    if (!s) return;
    state.money = Number(s.money)||0;
    state.prestige = Number(s.prestige)||0;
    if (s.city?.factories) state.city.factories = s.city.factories.map(f=>({x:f.x,y:f.y,level:f.level}));
    renderFactories(); updateHUD();
  }
  function gameApplyOffline(ms){ state.money += totalIPS() * (ms/1000); }

  function saveNow(show=true){ try{ const data=JSON.stringify(gameGetState()); localStorage.setItem(SAVE_KEY, data); if(show) toast('Mentve'); }catch(e){ console.error(e); toast('Ment√©s hiba'); } }
  function loadNow(){ try{ const raw=localStorage.getItem(SAVE_KEY); if(!raw){ toast('Nincs ment√©s'); return; } const s=JSON.parse(raw); const dt=Date.now() - (s.lastTick||Date.now()); gameSetState(s); if (dt>5000) gameApplyOffline(dt); toast('Bet√∂ltve'); }catch(e){ console.error(e); toast('Bet√∂lt√©s hiba'); } }
  function exportSave(){ try{ const b64=btoa(localStorage.getItem(SAVE_KEY) || ''); navigator.clipboard?.writeText(b64); prompt('M√°sold ki a ment√©st:', b64); }catch(e){ toast('Export hiba'); } }
  function importSave(){ const b64=prompt('Illeszd be az export√°lt ment√©st:'); if(!b64) return; try{ const raw=atob(b64); localStorage.setItem(SAVE_KEY, raw); loadNow(); }catch(e){ toast('Import hiba'); } }
  function resetSave(){ if(!confirm('Biztos? Minden t√∂rl≈ëdik.')) return; localStorage.removeItem(SAVE_KEY); location.reload(); }

  // ======= Men√ºgombok =======
  document.getElementById('btn-save').onclick = ()=>saveNow(true);
  document.getElementById('btn-load').onclick = ()=>loadNow();
  document.getElementById('btn-export').onclick = ()=>exportSave();
  document.getElementById('btn-import').onclick = ()=>importSave();
  document.getElementById('btn-reset').onclick = ()=>resetSave();
  document.getElementById('btn-pause').onclick = ()=>{ state.paused=!state.paused; toast(state.paused?'Sz√ºnet':'Folytat√°s'); };

  // ======= Loop =======
  let _last = performance.now();
  function loop(){
    const now = performance.now(); let dt = (now - _last)/1000; _last = now;
    if (!state.paused){ state.money += totalIPS() * dt; }
    updateHUD();
    requestAnimationFrame(loop);
  }

  // ======= Init =======
  function init(){
    buildGrid(); updateHUD();
    // bet√∂lt√©s + offline
    try{
      const raw=localStorage.getItem(SAVE_KEY);
      if(raw){ const s=JSON.parse(raw); const dt=Date.now() - (s.lastTick||Date.now()); gameSetState(s); if (dt>5000) gameApplyOffline(dt); }
    }catch{}
    setInterval(()=>saveNow(false), SAVE_MS);
    requestAnimationFrame(loop);
  }
  init();
  </script>
</body>
</html>
